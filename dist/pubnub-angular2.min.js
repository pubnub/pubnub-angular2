!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PubNubAngular=t():e.PubNubAngular=t()}(this,function(){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var a=n(1);e.exports=a.PubNubAngular,e.exports.PubNubAngular=a.PubNubAngular},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PubNubAngular=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(s),u=n(3);t.PubNubAngular=function(){function e(){if(a(this,e),"undefined"==typeof PubNub||null===PubNub)throw new Error("PubNub is not in global scope. Ensure that pubnub.js v4 library is included before the angular adapter");this.wrappers={}}return r(e,[{key:"init",value:function(e){var t=this.getInstance(i.default.default_instance_name);return t.init(e),t}},{key:"getInstance",value:function(e){var t=this,n=this.wrappers[e];return n&&n instanceof u.Wrapper?n:"string"==typeof e&&e.length>0?(this.wrappers[e]=new u.Wrapper(e,this),i.default.attributes_to_delegate.forEach(function(n){t.wrappers[e].wrapAttribute(n),t[n]||Object.defineProperty(t,n,{get:function(){return this.getInstance(i.default.default_instance_name)[n]}})}),i.default.methods_to_delegate.forEach(function(n){t.wrappers[e].wrapMethod(n),t[n]||(t[n]=function(){var e=this.getInstance(i.default.default_instance_name);return e[n].apply(e,arguments)})}),this.wrappers[e]):n}},{key:"subscribe",value:function(e){this.getInstance(i.default.default_instance_name).subscribe(e)}},{key:"unsubscribe",value:function(e){this.getInstance(i.default.default_instance_name).unsubscribe(e)}},{key:"getMessage",value:function(e,t){return this.getInstance(i.default.default_instance_name).getMessage(e,t)}},{key:"getPresence",value:function(e,t){this.getInstance(i.default.default_instance_name).getPresence(e,t)}},{key:"getStatus",value:function(e,t){this.getInstance(i.default.default_instance_name).getStatus(e,t)}},{key:"getError",value:function(e){this.getInstance(i.default.default_instance_name).getError(e)}},{key:"clean",value:function(e){this.getInstance(i.default.default_instance_name).clean(e)}}]),e}()},function(e,t){e.exports={pubnub_prefix:"pubnub",default_instance_name:"default",attributes_to_delegate:["channelGroups","push"],methods_to_delegate:["addListener","removeListener","removeAllListeners","hereNow","whereNow","getState","setState","grant","audit","publish","fire","history","time","reconnect","stop","unsubscribeAll","getSubscribedChannels","getSubscribedChannelGroups","encrypt","decrypt","getAuthKey","setAuthKey","setCipherKey","getUUID","setUUID","getFilterExpression","setFilterExpression"],common_callbacks_to_wrap:["callback","error"],subscribe_listener_events_to_broadcast:["message","presence","status"],history_sort_attribute:"timetoken"}},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Wrapper=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(4),i=n(5),u=n(6),o=n(7);t.Wrapper=function(){function e(t){a(this,e),this.label=t,this.pubnubInstance=null,this.broadcastOn=new i.Broadcast,this.outputOn=new u.Output,this.mockingInstance=new s.Mock(this.broadcastOn),this.autoload=new o.Autoload}return r(e,[{key:"init",value:function(e){this.pubnubInstance=new PubNub(e),this.mockingInstance.initializeListener(this),this.autoload.initialize(this)}},{key:"getLabel",value:function(){return this.label}},{key:"subscribe",value:function(e){this.getOriginalInstance().subscribe(e),this.mockingInstance.enableEventsBroadcast(e),this.autoload.enableLoad(e)}},{key:"unsubscribe",value:function(e){this.autoload.disableLoad(e),this.outputOn.unsubscribe(e),this.getOriginalInstance().unsubscribe(e);var t=this,n=setTimeout(function(){t.mockingInstance.disableEventsBroadcast(e),clearTimeout(n)},1e3)}},{key:"getMessage",value:function(e,t){var n=this;return this.outputOn.subscribe(e)&&this.autoload.getHistory(e,t),t&&this.broadcastOn.message(e,function(a){n.outputOn.push(e,a),t(a)}),this.outputOn.get(e)}},{key:"getPresence",value:function(e,t){this.broadcastOn&&this.broadcastOn.presence(e,t)}},{key:"getStatus",value:function(e,t){this.broadcastOn&&this.broadcastOn.status(e,t)}},{key:"getError",value:function(e){this.broadcastOn&&this.broadcastOn.error(e)}},{key:"clean",value:function(e){this.outputOn.clean(e)}},{key:"getOriginalInstance",value:function(){if(this.pubnubInstance)return this.pubnubInstance;throw new ReferenceError("Pubnub default instance is not initialized yet. Invoke #init() method first.")}},{key:"wrapAttribute",value:function(e){Object.defineProperty(this,e,{get:function(){return this.getOriginalInstance()[e]}})}},{key:"wrapMethod",value:function(e){this[e]=function(){return this.getOriginalInstance()[e].apply(this,arguments)}}}]),e}()},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Mock=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(s);t.Mock=function(){function e(t){a(this,e),this.listener=null,this.broadcaster=t,this.broadcastChannels={}}return r(e,[{key:"initializeListener",value:function(e){if(null===this.listener){var t=this;t.listener={},i.default.subscribe_listener_events_to_broadcast.forEach(function(e){t.listener[e]=function(n){n.subscription&&t.broadcastChannels[n.subscription]&&t.broadcastChannels[n.subscription].includes(e)&&(t.broadcaster.emit(e,n.subscription,n),n.channel&&t.broadcaster.emit(e,n.channel,n)),n.channel&&t.broadcastChannels[n.channel]&&t.broadcastChannels[n.channel].includes(e)&&t.broadcaster.emit(e,n.channel,n),"status"===e&&(n.error?t.broadcaster.emitError(n):n.affectedChannels||n.affectedChannelGroups?(n.affectedChannels.forEach(function(a){t.broadcastChannels[a]&&t.broadcastChannels[a].includes(e)&&t.broadcaster.emit(e,a,n)}),n.affectedChannelGroups.forEach(function(a){t.broadcastChannels[a]&&t.broadcastChannels[a].includes(e)&&t.broadcaster.emit(e,a,n)})):Object.keys(t.broadcastChannels).forEach(function(a){t.broadcaster.emit(e,a,n)}))}}),e.getOriginalInstance().addListener(this.listener)}}},{key:"addEventsBroadcast",value:function(e,t){var n=this;e.forEach(function(e){"boolean"==typeof t?n.broadcastChannels[e]=i.default.subscribe_listener_events_to_broadcast:Array.isArray(t)&&(n.broadcastChannels[e]=[],t.forEach(function(t){i.default.subscribe_listener_events_to_broadcast.includes(t)&&n.broadcastChannels[e].push(t)}))})}},{key:"removeEventBroadcast",value:function(e){var t=this;e.forEach(function(e){t.broadcastChannels[e]&&delete t.broadcastChannels[e]})}},{key:"enableEventsBroadcast",value:function(e){e.channels&&this.addEventsBroadcast(e.channels,e.triggerEvents),e.channelGroups&&this.addEventsBroadcast(e.channelGroups,e.triggerEvents)}},{key:"disableEventsBroadcast",value:function(e){e.channels&&this.removeEventBroadcast(e.channels),e.channelGroups&&this.removeEventBroadcast(e.channelGroups)}}]),e}()},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){Array.isArray(t)?t.forEach(function(t){e[t]=n}):e[t]=n}function s(e,t){Array.isArray(t)?t.forEach(function(t){e[t]&&delete e[t]}):e[t]&&delete e[t]}Object.defineProperty(t,"__esModule",{value:!0}),t.Broadcast=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(u);t.Broadcast=function(){function e(){var t=this;a(this,e),o.default.subscribe_listener_events_to_broadcast.forEach(function(e){var n="_".concat(e);t[n]={},t[e]=function(e,t){r(this[n],e,t)}})}return i(e,[{key:"emit",value:function(e,t,n){var a="_".concat(e);this[a]&&this[a][t]&&this[a][t].call(null,n)}},{key:"error",value:function(e){this._error=e}},{key:"emitError",value:function(e){this._error&&this._error.call(null,e)}},{key:"unsubscribe",value:function(e){var t=this;o.default.subscribe_listener_events_to_broadcast.forEach(function(n){var a="_".concat(n);s(t[a],e)})}}]),e}()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();t.Output=function(){function e(){n(this,e),this.channels={}}return a(e,[{key:"push",value:function(e,t){this.channels[e]&&this.channels[e].push(t)}},{key:"get",value:function(e){return this.channels[e]?this.channels[e]:null}},{key:"clean",value:function(e){this.channels[e]&&(this.channels[e].length=0)}},{key:"subscribe",value:function(e){return!this.channels[e]&&(this.channels[e]=[],!0)}},{key:"sort",value:function(e,t){this.channels[e]&&this.channels[e].sort(function(e,n){return e[t]>n[t]?1:e[t]<n[t]?-1:0})}},{key:"unsubscribe",value:function(e){this.channels[e]&&(this.clean(e),delete this.channels[e])}}]),e}()},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Autoload=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(s);t.Autoload=function(){function e(){a(this,e),this.count={},this.instance=void 0}return r(e,[{key:"initialize",value:function(e){this.instance=e}},{key:"enableLoad",value:function(e){var t=this;e.autoload&&"number"==typeof e.autoload&&(this.count[e.channels]=e.autoload,e.channels.forEach(function(n){t.count[n]=e.autoload}))}},{key:"getHistory",value:function(e,t){var n=this;if(this.count[e]){var a=this.instance,r=Array.isArray(e)?e:[e],s=r.length;r.forEach(function(r){a.history({channel:r,count:n.count[e]}).then(function(n){n.messages.forEach(function(t){t.message=t.entry,t.channel=r,a.outputOn.push(e,t)}),s-=1,t&&0===s&&(a.outputOn.sort(e,i.default.history_sort_attribute),t())}).catch(function(){})})}}},{key:"disableLoad",value:function(e){var t=this;Array.isArray(e.channels)?e.channels.forEach(function(e){t.count[e]&&delete t.count[e]}):this.count[e.channels]&&delete this.count[e.channels]}}]),e}()}])});